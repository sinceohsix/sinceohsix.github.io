<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>@sinceohsix's Files</title>
  <style>
    body {
      font-family: monospace;
      background: #fafafa;
      padding: 2rem;
    }
    a {
      display: inline-block;
      margin-bottom: 1rem;
      text-decoration: none;
      color: #0077cc;
    }
    pre {
      white-space: pre-wrap;
      word-break: break-word;
      background: #eee;
      padding: 1rem;
      border-radius: 6px;
    }
    img {
      max-width: 100%;
      height: auto;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <a href="index.html">← back</a>
  <h1 id="filename"></h1>
  <div id="preview">Loading…</div>

  <script>
    // Helper: get query param (?path=...)
    function getQueryParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    async function loadFile() {
      const logicalPath = getQueryParam("path"); // e.g. "files/archive.zip"
      if (!logicalPath) {
        document.getElementById("preview").textContent = "No file specified.";
        return;
      }

      // Show filename
      document.getElementById("filename").textContent = logicalPath;

      // Actual repo location: contents/ + logicalPath
      const realPath = "contents/" + logicalPath;

      try {
        const response = await fetch(realPath);

        if (!response.ok) {
          document.getElementById("preview").textContent =
            `Error: ${response.status} ${response.statusText}`;
          return;
        }

        // Decide how to preview based on extension
        const ext = logicalPath.split(".").pop().toLowerCase();

        if (["png","jpg","jpeg","gif","webp","svg"].includes(ext)) {
          // Image preview
          const img = document.createElement("img");
          img.src = realPath;
          document.getElementById("preview").innerHTML = "";
          document.getElementById("preview").appendChild(img);
        } else if (["txt","json","md","html","css","js"].includes(ext)) {
          // Text preview
          const text = await response.text();
          const pre = document.createElement("pre");
          pre.textContent = text;
          document.getElementById("preview").innerHTML = "";
          document.getElementById("preview").appendChild(pre);
        } else {
          // Download link fallback
          const link = document.createElement("a");
          link.href = realPath;
          link.download = logicalPath.split("/").pop();
          link.textContent = "Download " + logicalPath;
          document.getElementById("preview").innerHTML = "";
          document.getElementById("preview").appendChild(link);
        }

      } catch (err) {
        document.getElementById("preview").textContent = "Error loading file: " + err;
      }
    }

    loadFile();
  </script>
</body>
</html>
